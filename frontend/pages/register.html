<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <title>註冊</title>
</head>

<body>
  <div id="navbar"></div>

  <main class="flex justify-center relative" style="min-height: 100vh">
    <div class="flex justify-center items-center min-h-full">
      <div class="p-8 w-96 border border-2">
        <h2 class="text-2xl font-bold mb-6 text-center">
          註冊
        </h2>
        <hr class="border-black border-2 mb-4" />
        <!-- action="http://localhost:8080/user/register" method="post" enctype="multipart/form-data" -->
        <form>
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="username">
              姓名
            </label>
            <input
              class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              name="username" id="username" type="text" placeholder="輸入姓名" />
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="email">
              電子郵件
            </label>
            <input
              class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              name="email" id="email" type="email" placeholder="輸入電子郵件" />
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="passwd">
              密碼
            </label>
            <div class="relative">
              <input
                class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                name="password" id="password" type="password" placeholder="輸入密碼" />
              <i id="switchpassword"
                class="bi bi-eye-slash-fill absolute right-3 top-1/2 transform -translate-y-1/2"></i>
            </div>
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="passwdagain">
              確認密碼
            </label>
            <div class="relative">
              <input
                class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                name="comfirmpassword" id="comfirmpassword" type="password" placeholder="確認密碼" />
              <i id="switchcomfirmpassword"
                class="bi bi-eye-slash-fill absolute right-3 top-1/2 transform -translate-y-1/2"></i>
            </div>
          </div>
          <div class="flex items-center">
            <div class="mb-4 w-2/3">
              <label class="block text-gray-700 text-sm font-bold mb-2" for="birthday">
                生日
              </label>
              <input
                class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                name="birthday" id="birthday" type="date" />
            </div>
            <div class="mb-4 ml-4 w-1/3">
              <label class="block text-gray-700 text-sm font-bold mb-2" for="gender">
                性別
              </label>
              <select
                class="shadow border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                name="gender" id="gender">
                <option value="male">男性</option>
                <option value="female">女性</option>
              </select>
            </div>
          </div>
          <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="phone">
              電話
            </label>
            <input
              class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              name="phone" id="phone" type="tel" placeholder="輸入電話" />
          </div>
          <div>
            <p id="error"></p>
          </div>
          <div class="flex items-center justify-center mb-4">
            <button
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg w-full focus:outline-none focus:shadow-outline"
              type="button" id="btn">
              註冊
            </button>
          </div>
          <div class="flex items-center justify-center mb-4">
            <a href="/pages/login.html"
              class="inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800">
              已經是會員了嗎?
            </a>
          </div>
        </form>
      </div>
    </div>
  </main>

  <div id="footer"></div>
  <script src="../js/header-footer.js"></script>
  <script>
    let passwordeyeopen = 0;
    switchpassword.onclick = function () {
      if (passwordeyeopen == 0) {
        $('#password').attr("type", "text");
        $('#switchpassword').removeClass("bi-eye-slash-fill");
        $('#switchpassword').addClass("bi-eye-fill")
        passwordeyeopen = 1;
      } else {
        $('#password').attr("type", "password");
        $('#switchpassword').removeClass("bi-eye-fill");
        $('#switchpassword').addClass("bi-eye-slash-fill")
        passwordeyeopen = 0;
      }
    }

    let comfirmpasswordeyeopen = 0;
    switchcomfirmpassword.onclick = function () {
      if (comfirmpasswordeyeopen == 0) {
        $('#comfirmpassword').attr("type", "text");
        $('#switchcomfirmpassword').removeClass("bi-eye-slash-fill");
        $('#switchcomfirmpassword').addClass("bi-eye-fill")
        comfirmpasswordeyeopen = 1;
      } else {
        $('#comfirmpassword').attr("type", "password");
        $('#switchcomfirmpassword').removeClass("bi-eye-fill");
        $('#switchcomfirmpassword').addClass("bi-eye-slash-fill")
        comfirmpasswordeyeopen = 0;
      }
    }
    btn.onclick = function () {
      $('#error').text("")
      if ($('#username').val() == "") {
        $('#error').text("姓名為空");
      } else if ($('#email').val() == "") {
        $('#error').text("信箱為空");
      } else if ($('#password').val() == "") {
        $('#error').text("密碼為空");
      } else if ($('#password').val() != $('#comfirmpassword').val()) {
        $('#error').text("密碼與確認密碼不一致");
      } else if ($('#birthday').val() == "") {
        $('#error').text("生日為空");
      } else if ($('#phone').val() == "") {
        $('#error').text("電話為空");
      } else {
        const data = {
          "email": $('#email').val(),
          "password": $('#password').val(),
          "userInfo": {
            "userName": $('#username').val(),
            "birthday": $('#birthday').val(),
            "gender": $('#gender').val(),
            "phone": $('#phone').val()
          }
        };
        fetch("http://localhost:8080/user/register", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',  // 設置請求內容類型為 JSON
          },
          body: JSON.stringify(data),  // 將表單數據轉換為 JSON 字符串
        })
          .then((response) => response.text())
          .then(result => {

            if (result == "true") {
              $('#error').text("註冊成功，等待兩秒後進入登入頁面");
              setTimeout(() => { window.location.href = './login.html' }, 2000);
            } else {
              $('#error').text("信箱已被註冊");
            }
          })
      }
    }


    fetch("../components/navbar.html")
      .then((response) => response.text())
      .then((data) => {
        $("#navbar").html(data);
      });

    fetch("../components/footer.html")
      .then((response) => response.text())
      .then((data) => {
        $("#footer").html(data);
      });
  </script>
</body>

</html>