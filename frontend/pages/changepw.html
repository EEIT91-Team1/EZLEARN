<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>

<body>
    <div id="content">

    </div>

</body>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');

    let api = "http://localhost:8080/user/changepwisExpired";
    const data = {
        "resetToken": id,
    };
    fetch(api, {
        method: 'post',
        headers: {
            'Content-Type': 'application/json',  // 設置請求內容類型為 JSON
        },
        body: JSON.stringify(data),  // 將表單數據轉換為 JSON 字符串
        credentials: 'include'
    })
        .then((response) => response.text())
        .then(result => {
            if (result == 1) {
                document.getElementById('content').innerHTML = 
                "<input type='text' id='password'><input type='text'><button name='btn'>送出</button>"
            }else if(result == 2){
                document.getElementById('content').innerHTML = "404";
            }else{
                document.getElementById('content').innerHTML = "該連結已失效";
            }

        })

    $('#content').on('click', 'button[name="btn"]', function () {
        console.log("a");

        let api = "http://localhost:8080/user/changepw";
        const data = {
            "resetToken": id,
            "password": $('#password').val(),
        };
        fetch(api, {
            method: 'put',
            headers: {
                'Content-Type': 'application/json',  // 設置請求內容類型為 JSON
            },
            body: JSON.stringify(data),  // 將表單數據轉換為 JSON 字符串
            credentials: 'include'
        })

    })
</script>

</html>