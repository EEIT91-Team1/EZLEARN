<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <link rel="icon" href="../imgs/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <title>訂單歷史紀錄</title>
  </head>
  <body class="bg-gray-50">
    <div id="navbar"></div>

    <main class="container mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold mb-8">訂單歷史紀錄</h1>

      <div class="max-w-4xl mx-auto">
        <div id="orderList" class="space-y-6"></div>

        <div id="noOrders" class="hidden text-center py-12">
          <i
            class="bi bi-inbox text-4xl text-gray-400 mb-4"
          ></i>
          <p class="text-gray-500">目前沒有任何訂單記錄</p>
        </div>
      </div>
    </main>

    <div id="footer"></div>

    <script>
      $(document).ready(function () {
        fetch("../components/navbar.html")
          .then((response) => response.text())
          .then((data) => {
            $("#navbar").html(data);
          });

        fetch("../components/footer.html")
          .then((response) => response.text())
          .then((data) => {
            $("#footer").html(data);
          });

        const sampleOrders = [
          {
            orderNumber: "ORD20240301",
            date: "2024-03-01T10:30:00",
            status: "success",
            amount: 5980,
            items: [
              {
                title: "零基礎Python程式設計入門課程",
                price: 2990,
              },
              {
                title: "JavaScript網頁互動特效實戰",
                price: 2990,
              },
            ],
          },
          {
            orderNumber: "ORD20240215",
            date: "2024-02-15T15:45:00",
            status: "success",
            amount: 3980,
            items: [
              {
                title: "職場英語會話完全攻略",
                price: 3980,
              },
            ],
          },
          {
            orderNumber: "ORD20240120",
            date: "2024-01-20T09:15:00",
            status: "failed",
            amount: 4990,
            items: [
              {
                title: "股票投資實戰技巧大全",
                price: 4990,
              },
            ],
          },
        ];

        localStorage.setItem(
          "orderHistory",
          JSON.stringify(sampleOrders)
        );

        const orders = JSON.parse(
          localStorage.getItem("orderHistory") || "[]"
        );
        const orderList =
          document.getElementById("orderList");
        const noOrders =
          document.getElementById("noOrders");

        if (orders.length === 0) {
          noOrders.classList.remove("hidden");
          return;
        }

        orders.forEach((order) => {
          const orderElement = `
            <div class="bg-white rounded-lg shadow-md p-6">
              <div class="flex justify-between items-center mb-4">
                <div>
                  <h2 class="text-xl font-bold">訂單編號：${
                    order.orderNumber
                  }</h2>
                  <p class="text-gray-500">${new Date(
                    order.date
                  ).toLocaleString()}</p>
                </div>
                <span class="px-4 py-2 rounded-full ${
                  order.status === "success"
                    ? "bg-green-100 text-green-800"
                    : "bg-red-100 text-red-800"
                }">
                  ${
                    order.status === "success"
                      ? "付款成功"
                      : "付款失敗"
                  }
                </span>
              </div>

              <div class="border-t border-b py-4 my-4">
                ${order.items
                  .map(
                    (item) => `
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-lg">${
                      item.title
                    }</span>
                    <span class="text-lg">NT$ ${item.price.toLocaleString()} 元</span>
                  </div>
                `
                  )
                  .join("")}
              </div>

              <div class="flex justify-between items-center">
                <span class="text-gray-600">共 ${
                  order.items.length
                } 件商品</span>
                <span class="text-xl font-bold">
                  總計：NT$ ${order.amount.toLocaleString()} 元
                </span>
              </div>
            </div>
          `;
          orderList.innerHTML += orderElement;
        });
      });
    </script>
  </body>
</html>
