<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <link rel="icon" href="../imgs/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <title>購物車</title>
  </head>
  <body>
    <div id="navbar"></div>

    <main class="container mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold mb-8">購物車</h1>

      <div class="flex flex-col lg:flex-row gap-8">
        <div class="lg:w-2/3">
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center mb-4">
              <input
                type="checkbox"
                class="select-all mr-4"
                onclick="toggleAllItems(this)"
              />
              <span class="flex-grow">課程</span>
              <span class="w-32 text-right">課程價格</span>
              <span class="w-16"></span>
            </div>

            <div class="border-t py-4">
              <div class="flex items-center">
                <input
                  type="checkbox"
                  class="cart-item mr-4"
                  onchange="updateOrderSummary()"
                />
                <div class="flex-grow flex items-center">
                  <img
                    src="../imgs/course-placeholder.jpg"
                    alt="課程圖片"
                    class="w-32 h-24 object-cover rounded mr-4"
                  />
                  <div>
                    <h3 class="text-lg font-medium">
                      課程名稱
                    </h3>
                    <div class="text-gray-600">
                      課程資訊/優惠資訊
                    </div>
                  </div>
                </div>
                <span class="w-32 text-right price"
                  >NT$ 9999</span
                >
                <button
                  onclick="removeItem(this)"
                  class="w-16 text-right text-gray-500 hover:text-red-500"
                >
                  刪除
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="lg:w-1/3">
          <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">訂單明細</h2>
            <div class="flex justify-between mb-2">
              <span
                ><span id="selectedItemCount">0</span>
                件商品</span
              >
              <span>NT$ <span id="subtotal">0</span></span>
            </div>
            <div
              class="flex justify-between text-2xl font-bold mb-6"
            >
              <span>總計</span>
              <span>NT$ <span id="total">0</span> 元</span>
            </div>
            <button
              onclick="proceedToCheckout()"
              class="w-full bg-black text-white py-3 rounded-lg hover:bg-gray-800 transition"
              id="checkoutButton"
              disabled
            >
              結帳
            </button>
          </div>
        </div>
      </div>
    </main>

    <div id="footer"></div>
    <script>
      fetch("../components/navbar.html")
        .then((response) => response.text())
        .then((data) => {
          $("#navbar").html(data);
        });

      fetch("../components/footer.html")
        .then((response) => response.text())
        .then((data) => {
          $("#footer").html(data);
        });

      function toggleAllItems(checkbox) {
        document
          .querySelectorAll(".cart-item")
          .forEach((item) => {
            item.checked = checkbox.checked;
          });
        updateOrderSummary();
      }

      function removeItem(button) {
        button.closest(".border-t").remove();
        updateOrderSummary();
      }

      function updateOrderSummary() {
        const checkedItems = document.querySelectorAll(
          ".cart-item:checked"
        );
        document.getElementById(
          "selectedItemCount"
        ).textContent = checkedItems.length;

        let total = 0;
        const selectedItems = [];

        checkedItems.forEach((item) => {
          const itemContainer = item.closest(".flex");
          const priceElement =
            itemContainer.querySelector(".price");
          const titleElement =
            itemContainer.querySelector("h3");
          const price = parseInt(
            priceElement.textContent
              .replace("NT$ ", "")
              .replace(",", "")
          );

          selectedItems.push({
            title: titleElement.textContent,
            price: price,
          });

          total += price;
        });

        document.getElementById("subtotal").textContent =
          total.toLocaleString();
        document.getElementById("total").textContent =
          total.toLocaleString();

        const checkoutButton = document.getElementById(
          "checkoutButton"
        );
        checkoutButton.disabled = checkedItems.length === 0;

        localStorage.setItem(
          "cartItems",
          JSON.stringify(selectedItems)
        );
        localStorage.setItem("cartTotal", total);
      }

      function proceedToCheckout() {
        const checkedItems = document.querySelectorAll(
          ".cart-item:checked"
        );
        if (checkedItems.length > 0) {
          window.location.href = "order.html";
        }
      }
    </script>
  </body>
</html>
